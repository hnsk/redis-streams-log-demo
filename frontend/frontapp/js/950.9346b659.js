"use strict";(globalThis["webpackChunklog_demo_quasar"]=globalThis["webpackChunklog_demo_quasar"]||[]).push([[950],{950:(e,a,l)=>{l.r(a),l.d(a,{default:()=>O});var t=l(3673);function o(e,a,l,o,n,s){const i=(0,t.up)("SearchTable");return(0,t.wg)(),(0,t.j4)(i)}var n=l(2323),s=l(8880);const i={class:"q-gutter-md q-pa-md"},r={class:"col-4"},u={class:"row q-pa-md"},g={class:"col-3"},d={class:"col-7"},m={class:"q-pa-md"},p={key:0},c={key:1},v={style:{"font-family":"monospace"}},f=["innerHTML"],_={key:2},h=["innerHTML"],w=["onClick"],y={key:4};function b(e,a,l,o,b,q){const k=(0,t.up)("q-btn"),H=(0,t.up)("q-select"),L=(0,t.up)("q-table"),V=(0,t.up)("q-tooltip"),x=(0,t.up)("q-banner"),P=(0,t.up)("q-input"),T=(0,t.up)("q-popup-edit"),U=(0,t.up)("q-td");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("div",i,[(0,t._)("div",r,[(0,t.Wm)(H,{"use-input":"","fill-input":"","hide-dropdown-icon":"","hide-selected":"","model-value":o.search_string,options:o.searchOptions,"transition-duration":"0","input-debounce":"0",onInputValue:a[1]||(a[1]=e=>o.search_string=e),onFilter:o.getAutocompleteOptions,label:"Search logs",style:{width:"50%"}},{after:(0,t.w5)((()=>[(0,t.Wm)(k,{round:"",dense:"",flat:"",icon:"clear",color:"primary",onClick:a[0]||(a[0]=e=>o.search_string="*")})])),_:1},8,["model-value","options","onFilter"])])]),(0,t._)("div",u,[(0,t._)("div",g,[(0,t.Wm)(L,{title:"Aggregates",dense:"",rows:o.aggregates,columns:o.aggregate_columns,"hide-pagination":!0,"row-key":"field",pagination:{rowsPerPage:0}},null,8,["rows","columns"])]),(0,t._)("div",d,[(0,t.Wm)(x,{class:"bg-grey-9 text-white q-ma-md text-weight-bold codebox"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(o.literal_aggregate_query)+" ",1),(0,t.Wm)(V,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Literal aggregate query")])),_:1})])),_:1}),(0,t.Wm)(x,{class:"bg-grey-9 text-white q-ma-md text-weight-bold codebox"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(o.literal_search_query)+" ",1),(0,t.Wm)(V,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Literal search query")])),_:1})])),_:1})])]),(0,t._)("div",m,[(0,t.Wm)(L,{title:`Results in ${o.search_duration}ms`,dense:"",rows:o.messages,columns:o.search_columns,"row-key":"id",pagination:o.pagination,"onUpdate:pagination":a[2]||(a[2]=e=>o.pagination=e),"binary-state-sort":"",onRequest:o.paginationRequest,"virtual-scroll":"",class:"fit"},{"body-cell":(0,t.w5)((e=>[(0,t.Wm)(U,{props:e},{default:(0,t.w5)((()=>["log_level"==e.col.name?((0,t.wg)(),(0,t.iD)("div",p,[(0,t.Wm)(H,{modelValue:o.messages[e.pageIndex].log_level,"onUpdate:modelValue":[a=>o.messages[e.pageIndex].log_level=a,a=>o.updateLogKey(e.key,e.col.name,o.messages[e.pageIndex].log_level)],dense:"",outlined:"","bg-color":o.levelColors[e.value.toLowerCase()].bg,options:o.logLevels,"hide-dropdown-icon":"","transition-duration":"0"},null,8,["modelValue","onUpdate:modelValue","bg-color","options"])])):"message"==e.col.name?((0,t.wg)(),(0,t.iD)("div",c,[(0,t._)("div",v,[(0,t._)("span",{innerHTML:e.value},null,8,f)]),(0,t.Wm)(T,{modelValue:o.messages[e.pageIndex].message,"onUpdate:modelValue":a=>o.messages[e.pageIndex].message=a,"auto-save":"",onBeforeHide:a=>o.updateLogKey(e.key,e.col.name,o.messages[e.pageIndex].message)},{default:(0,t.w5)((a=>[(0,t.Wm)(P,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e,dense:"",autofocus:"",onKeyup:(0,s.D2)((l=>{a.set(),o.updateLogKey(e.key,e.col.name,a.value)}),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","onBeforeHide"])])):"hostname"==e.col.name?((0,t.wg)(),(0,t.iD)("div",_,[(0,t._)("span",{innerHTML:e.value},null,8,h),(0,t.Wm)(T,{modelValue:o.messages[e.pageIndex].hostname,"onUpdate:modelValue":a=>o.messages[e.pageIndex].hostname=a,"auto-save":"",onBeforeHide:a=>o.updateLogKey(e.key,e.col.name,o.messages[e.pageIndex].hostname)},{default:(0,t.w5)((a=>[(0,t.Wm)(P,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e,dense:"",autofocus:"",onKeyup:(0,s.D2)((l=>{a.set(),o.updateLogKey(e.key,e.col.name,a.value)}),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])])),_:2},1032,["modelValue","onUpdate:modelValue","onBeforeHide"])])):"timestamp"==e.col.name?((0,t.wg)(),(0,t.iD)("div",{key:3,onClick:a=>o.addTimestampToQuery(e.row.timestamp)},[(0,t.Uk)((0,n.zw)(e.value)+" ",1),(0,t.Wm)(k,{icon:o.time_range_selector?"arrow_right":"arrow_left",flat:""},{default:(0,t.w5)((()=>[(0,t.Wm)(V,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(o.time_range_selector?"Select beginning of range":"Select end of range"),1)])),_:1})])),_:1},8,["icon"])],8,w)):((0,t.wg)(),(0,t.iD)("div",y,(0,n.zw)(e.value),1))])),_:2},1032,["props"])])),_:1},8,["title","rows","columns","pagination","onRequest"])])])}var q=l(1959),k=l(5474),H=l(1082),L=l(4584);const V={setup(){function e(e){return e.toLowerCase()}let a=(0,q.iH)([]),l=(0,q.iH)([]),o=(0,q.iH)(0),n=(0,q.iH)(0),s=(0,q.iH)(0),i=(0,q.iH)(""),r=(0,q.iH)(""),u=(0,q.iH)({showSearch:!0}),g=(0,q.iH)({rowsPerPage:25,page:1,rowsNumber:0,sortBy:"timestamp",descending:!0});const d={debug:{bg:"blue-2",fg:"grey-10"},info:{bg:"info",fg:"grey-10"},warning:{bg:"warning",fg:"grey-10"},error:{bg:"red-6",fg:"grey-1"},critical:{bg:"red-10",fg:"grey-1"}},m=["DEBUG","INFO","WARNING","ERROR","CRITICAL"],p=["*","hello","%hllo%","hel*","@hostname:123","@log_level:{warning}","%hllo% @hostname:123 @log_level:{warning|debug}"],c=[{name:"timestamp",field:"timestamp",label:"Timestamp",align:"left",format:e=>H.ZP.formatDate(parseInt(e),"YYYY-MM-DD HH:mm:ss.SSS"),sortable:!0},{name:"hostname",field:"hostname",label:"Hostname",align:"left",sortable:!0},{name:"log_level",field:"log_level",label:"Log Level",align:"center",sortable:!0},{name:"city",field:"city",label:"City",align:"left",sortable:!0},{name:"message",field:"message",label:"Message",style:"width: 100%",align:"left"}],v=[{name:"field",field:"field",label:"Log Level",align:"left",classes:a=>e(a.field)},{name:"entries",field:"entries",label:"Entries",align:"left"}];let f=(0,q.iH)("*");function _(e){k.api.post("api/search/aggregate",{query:e,field:"log_level"}).then((e=>{let a=[];r.value=e.data.literal_query;for(let l of e.data.results)a.push(l);l.value.splice(0,l.value.length,...a)}))}function h(e){const{page:a,rowsPerPage:l,descending:t,sortBy:o}=e.pagination,n=(a-1)*l;w(f.value,n,l,o,!t),g.value.rowsPerPage=l,g.value.page=a,g.value.descending=t,g.value.sortBy=o}function w(e,l,t,r,u){f.value=e.length>2?e:"*",k.api.post("api/search",{query:f.value,start:l,limit:t,sortby:r,sort_asc:u}).then((e=>{e.data.error?i.value=e.data.error:(a.value.splice(0,a.value.length,...e.data.messages),o.value=e.data.numresults,n.value=e.data.total,i.value=e.data.literal_query,s.value=e.data.duration,g.value.rowsNumber=e.data.total,_(f.value))}))}function y(e,a,l){k.api.post("api/log/message/modify",{key:e,field:a,value:l})}(0,t.YP)(f,(e=>{g.value.page=1,w(e,0,g.value.rowsPerPage,g.value.sortBy,!g.value.descending)}));let b=(0,q.iH)(["moi"]);function V(e,a,l){let t=[];a((()=>{t=e.split(" ");const a=t[t.length-1];k.api.post("api/search/suggestion/get",{index:"autocomplete",prefix:a}).then((e=>{let a=[];t.pop();for(let l of e.data)a.push(`${t.join(" ").trim()} ${l}`);console.log,b.value=a}))}))}let x=(0,q.iH)([]),P=(0,q.iH)(!0);function T(e){x.value.length<2?(x.value.push(e),P.value=!1,2==x.value.length&&(P.value=!0,"*"==f.value?f.value=`@timestamp:[${x.value.join(" ")}]`:f.value=`${f.value} @timestamp:[${x.value.join(" ")}]`)):x.value=[e],console.log(x.value),console.log(f.value)}return(0,t.bv)((()=>{w(f.value,(g.value.page-1)*g.value.rowsPerPage,g.value.rowsPerPage,g.value.sortBy,!g.value.descending)})),{search_columns:c,aggregate_columns:v,aggregates:l,messages:a,store:L.Z,search_string:f,search_duration:s,num_results:o,total_results:n,literal_search_query:i,literal_aggregate_query:r,example_queries:p,levelColors:d,updateLogKey:y,logLevels:m,searchParams:u,searchOptions:b,getAutocompleteOptions:V,addTimestampToQuery:T,time_range_selector:P,paginationRequest:h,pagination:g}}};var x=l(4260),P=l(4880),T=l(8240),U=l(6429),W=l(5607),I=l(5363),B=l(3884),C=l(4522),D=l(4842),Z=l(7518),S=l.n(Z);const K=(0,x.Z)(V,[["render",b]]),Q=K;S()(V,"components",{QSelect:P.Z,QBtn:T.Z,QTable:U.Z,QBanner:W.Z,QTooltip:I.Z,QTd:B.Z,QPopupEdit:C.Z,QInput:D.Z});const R={components:{SearchTable:Q},setup(){return{SearchTable:Q}}},M=(0,x.Z)(R,[["render",o]]),O=M}}]);